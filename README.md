# Telegram Bot с RAG-системой для кондиционеров

Телеграм-бот с RAG-системой, который отвечает на вопросы по мануалам кондиционеров компании "Лучшие кондиционеры".

## Архитектура системы

1. **LLM-диспетчер** - определяет тип запроса (простой ответ, уточнение, поиск в мануале)
2. **LLM-ретривер** - извлекает модель кондиционера и тему из последних 3 сообщений
3. **Гибридный поиск** - ищет релевантную информацию в FAISS базе конкретной модели по косинусному сходству и по ключевым словам
4. **LLM-ассистент** - проверяет релевантность найденной информации
5. **LLM-генератор** - создает финальный ответ пользователю

## Установка и настройка

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` и заполните его:

```bash
# Обязательные параметры
BOT_TOKEN=your_telegram_bot_token_here
OPENAI_API_KEY=your_openai_api_key_here (если используете OpenAI)


# Опциональные параметры
# LLM_URL=http://localhost:8000/v1  # Для использования кастомного LLM
# EMBEDDINGS_MODEL= #Для использования другой эмбеддинг-модели
# VECTOR_DB_DIR = #Для указания пути создания векторной бд
```

### 3. Создание векторных баз

Запустите для создания примеров векторных баз:

```bash
python db_creation.py
```

Каждый из .pdf файлов в директории препроцессится следующим образом:
- Из первой или второй страницы с помощью vlm извлекается модель кондиционера
- Из каждой страницы pdf извлекается текст, если нет изображений или таблиц
- Если есть изображения или таблицы отправляется запрос в vlm для описания схем, изображений и таблиц сплошным текстом
- Текст делится на чанки, векторизуется и для каждого из названий модели создаются индексы и текстовые файлы

### 4. Запуск бота

```bash
python main.py
```

## Структура файлов

- `main.py` - основная логика бота с обработкой сообщений
- `llm_functions.py` - все LLM функции (диспетчер, извлекатель, проверка релевантности, генератор ответов)
- `retrieving_utils.py` - вспомогательные функции для работы с векторными базами
- `.env` - конфигурация (токены, API ключи)
- `requirements.txt` - зависимости проекта
- 'db_creation.py' - создание векторной базы

## Как работает бот

### Простые запросы
Бот отвечает сразу на:
- Приветствия ("Привет!", "Здравствуйте")
- Вопросы о боте ("Кто ты?", "Что ты умеешь?")
- Общие вопросы о компании

### Запросы с уточнением
Если пользователь спрашивает о кондиционере, но не указал модель, бот попросит уточнить модель.

### Поиск в мануалах
1. Показывает сообщение "Мне понадобится время для ответа. Подождите..."
2. Извлекает модель и тему из последних 3 сообщений
3. Ищет базу для модели
4. Выполняет семантический поиск и поиск по ключевым словам по теме
5. Проверяет релевантность найденной информации
6. Генерирует подробный ответ
